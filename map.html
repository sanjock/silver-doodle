<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leaflet ì „ì²´í™”ë©´ ì§€ë„ - ì™„ë²½ ë²„ì „</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        /* 1. ì „ì²´ ì´ˆê¸°í™” - ë§¤ìš° ì¤‘ìš”! */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* 2. html, body 100% ì„¤ì • - í•„ìˆ˜! */
        html, body {
            height: 100%;
            width: 100%;
            overflow: hidden; /* ìŠ¤í¬ë¡¤ë°” ì œê±° */
        }
        
        /* 3. ì§€ë„ ì»¨í…Œì´ë„ˆ - 100% ì±„ìš°ê¸° */
        #map {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
        }
        
        /* 4. ë¡œë”© ì¸ë””ì¼€ì´í„° */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .loading-content {
            text-align: center;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 5. ì»¨íŠ¸ë¡¤ íŒ¨ë„ */
        .control-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            max-width: 300px;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .control-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 8px;
        }
        
        .button-group {
            display: grid;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 20px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.5);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #95a5a6 0%, #7f8c8d 100%);
        }
        
        .info-box {
            margin-top: 15px;
            padding: 12px;
            background: #ecf0f1;
            border-radius: 6px;
            font-size: 13px;
            line-height: 1.6;
            color: #34495e;
        }
        
        .info-item {
            margin-bottom: 8px;
        }
        
        .info-label {
            font-weight: 600;
            color: #2c3e50;
        }
        
        /* 6. ìƒíƒœ í‘œì‹œ */
        .status-indicator {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: white;
            padding: 10px 15px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 1000;
            font-size: 13px;
            font-family: 'Segoe UI', sans-serif;
        }
        
        .status-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-loading {
            background: #f39c12;
        }
        
        .status-ready {
            background: #27ae60;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* 7. ì»¤ìŠ¤í…€ íŒì—… */
        .leaflet-popup-content-wrapper {
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        
        .custom-popup {
            font-family: 'Segoe UI', sans-serif;
            padding: 10px;
        }
        
        .popup-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .popup-content {
            font-size: 13px;
            color: #7f8c8d;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="spinner"></div>
            <div>ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
    </div>
    
    <!-- ì§€ë„ ì»¨í…Œì´ë„ˆ -->
    <div id="map"></div>
    
    <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
    <div class="control-panel">
        <div class="control-title">ğŸ—ºï¸ ì§€ë„ ì»¨íŠ¸ë¡¤</div>
        
        <div class="button-group">
            <button class="btn" onclick="goToSeoul()">ğŸ“ ì„œìš¸ì‹œì²­</button>
            <button class="btn" onclick="goToGangnam()">ğŸ™ï¸ ê°•ë‚¨ì—­</button>
            <button class="btn" onclick="goToBusan()">ğŸŒŠ ë¶€ì‚°</button>
            <button class="btn btn-secondary" onclick="addMarkers()">ğŸ“Œ ë§ˆì»¤ ì¶”ê°€</button>
            <button class="btn btn-secondary" onclick="clearMarkers()">ğŸ—‘ï¸ ë§ˆì»¤ ì œê±°</button>
            <button class="btn btn-secondary" onclick="toggleFullscreen()">â›¶ ì „ì²´í™”ë©´</button>
        </div>
        
        <div class="info-box">
            <div class="info-item">
                <span class="info-label">ì¤Œ ë ˆë²¨:</span>
                <span id="zoomLevel">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">ì¤‘ì‹¬ ì¢Œí‘œ:</span>
                <div id="centerCoords">-</div>
            </div>
            <div class="info-item">
                <span class="info-label">ë¡œë”© íƒ€ì¼:</span>
                <span id="tileCount">0</span>
            </div>
        </div>
    </div>
    
    <!-- ìƒíƒœ í‘œì‹œ -->
    <div class="status-indicator">
        <span class="status-dot status-loading" id="statusDot"></span>
        <span id="statusText">ì´ˆê¸°í™” ì¤‘...</span>
    </div>
    
    <script>
        // ==========================================
        // 1. ì „ì—­ ë³€ìˆ˜
        // ==========================================
        let map = null;
        let markers = [];
        let tileLoadCount = 0;
        
        // ==========================================
        // 2. ì§€ë„ ì´ˆê¸°í™” (í•µì‹¬!)
        // ==========================================
        function initializeMap() {
            console.log('ì§€ë„ ì´ˆê¸°í™” ì‹œì‘...');
            
            // ì§€ë„ ìƒì„±
            map = L.map('map', {
                center: [37.5665, 126.9780], // ì„œìš¸ì‹œì²­
                zoom: 17,
                zoomControl: true,
                attributionControl: true,
                // ì¤‘ìš”: íƒ€ì¼ ë¡œë”© ìµœì í™” ì˜µì…˜
                preferCanvas: false,
                renderer: L.canvas()
            });
            
            // íƒ€ì¼ ë ˆì´ì–´ ì¶”ê°€
            const tileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: 'Â© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
                maxZoom: 19,
                minZoom: 5,
                // ì¤‘ìš”: íƒ€ì¼ ë¡œë”© ì˜µì…˜
                keepBuffer: 2, // í™”ë©´ ë°– íƒ€ì¼ ìœ ì§€
                updateWhenZooming: false, // ì¤Œ ì¤‘ ì—…ë°ì´íŠ¸ ì•ˆ í•¨ (ì„±ëŠ¥)
                updateWhenIdle: true, // ì´ë™ ë©ˆì¶˜ í›„ ì—…ë°ì´íŠ¸
                crossOrigin: true
            });
            
            tileLayer.addTo(map);
            
            // íƒ€ì¼ ë¡œë”© ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            tileLayer.on('loading', function() {
                tileLoadCount++;
                updateStatus('loading', 'íƒ€ì¼ ë¡œë”© ì¤‘...');
                document.getElementById('tileCount').textContent = tileLoadCount;
            });
            
            tileLayer.on('load', function() {
                updateStatus('ready', 'ì¤€ë¹„ ì™„ë£Œ');
                console.log('ëª¨ë“  íƒ€ì¼ ë¡œë“œ ì™„ë£Œ');
            });
            
            tileLayer.on('tileerror', function(error) {
                console.error('íƒ€ì¼ ë¡œë“œ ì‹¤íŒ¨:', error);
            });
            
            // ì§€ë„ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            map.on('zoomend', updateMapInfo);
            map.on('moveend', updateMapInfo);
            
            // ì´ˆê¸° ì •ë³´ ì—…ë°ì´íŠ¸
            updateMapInfo();
            
            console.log('ì§€ë„ ì´ˆê¸°í™” ì™„ë£Œ');
        }
        
        // ==========================================
        // 3. ì§€ë„ í¬ê¸° ì¬ì¡°ì • (ë¬¸ì œ í•´ê²° í•µì‹¬!)
        // ==========================================
        function fixMapSize() {
            console.log('ì§€ë„ í¬ê¸° ì¬ì¡°ì • ì‹œì‘...');
            
            // ì—¬ëŸ¬ ë²ˆ ì‹œë„ (íƒ€ì´ë° ë¬¸ì œ í•´ê²°)
            const delays = [0, 100, 250, 500];
            
            delays.forEach(delay => {
                setTimeout(() => {
                    if (map) {
                        map.invalidateSize({
                            animate: false,
                            pan: false
                        });
                        console.log(`invalidateSize ì‹¤í–‰ (${delay}ms)`);
                    }
                }, delay);
            });
        }
        
        // ==========================================
        // 4. ìƒíƒœ ì—…ë°ì´íŠ¸
        // ==========================================
        function updateStatus(status, text) {
            const dot = document.getElementById('statusDot');
            const statusText = document.getElementById('statusText');
            
            dot.className = 'status-dot status-' + status;
            statusText.textContent = text;
        }
        
        function updateMapInfo() {
            if (!map) return;
            
            const center = map.getCenter();
            const zoom = map.getZoom();
            
            document.getElementById('zoomLevel').textContent = zoom;
            document.getElementById('centerCoords').innerHTML = 
                `${center.lat.toFixed(6)}<br>${center.lng.toFixed(6)}`;
        }
        
        // ==========================================
        // 5. ìœ„ì¹˜ ì´ë™ í•¨ìˆ˜ë“¤
        // ==========================================
        function goToSeoul() {
            map.flyTo([37.5665, 126.9780], 17, {
                duration: 1.5
            });
        }
        
        function goToGangnam() {
            map.flyTo([37.4979, 127.0276], 17, {
                duration: 1.5
            });
        }
        
        function goToBusan() {
            map.flyTo([35.1796, 129.0756], 15, {
                duration: 2
            });
        }
        
        // ==========================================
        // 6. ë§ˆì»¤ ê´€ë¦¬
        // ==========================================
        function addMarkers() {
            // ê¸°ì¡´ ë§ˆì»¤ ì œê±°
            clearMarkers();
            
            const locations = [
                { pos: [37.5665, 126.9780], name: 'ì„œìš¸ì‹œì²­', desc: 'ì„œìš¸íŠ¹ë³„ì‹œì²­ ë³¸ê´€' },
                { pos: [37.5797, 126.9770], name: 'ê²½ë³µê¶', desc: 'ì¡°ì„ ì‹œëŒ€ ê¶ê¶' },
                { pos: [37.5511, 126.9882], name: 'ë‚¨ì‚°íƒ€ì›Œ', desc: 'Nì„œìš¸íƒ€ì›Œ' }
            ];
            
            locations.forEach(loc => {
                const marker = L.marker(loc.pos).addTo(map);
                
                const popupContent = `
                    <div class="custom-popup">
                        <div class="popup-title">${loc.name}</div>
                        <div class="popup-content">${loc.desc}</div>
                    </div>
                `;
                
                marker.bindPopup(popupContent);
                markers.push(marker);
            });
            
            // ì²« ë§ˆì»¤ ì—´ê¸°
            if (markers.length > 0) {
                markers[0].openPopup();
            }
            
            console.log(`${markers.length}ê°œ ë§ˆì»¤ ì¶”ê°€ë¨`);
        }
        
        function clearMarkers() {
            markers.forEach(marker => {
                map.removeLayer(marker);
            });
            markers = [];
            console.log('ëª¨ë“  ë§ˆì»¤ ì œê±°ë¨');
        }
        
        // ==========================================
        // 7. ì „ì²´í™”ë©´ í† ê¸€
        // ==========================================
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }
        
        // ì „ì²´í™”ë©´ ë³€ê²½ ì‹œ ì§€ë„ í¬ê¸° ì¬ì¡°ì •
        document.addEventListener('fullscreenchange', () => {
            setTimeout(() => fixMapSize(), 100);
        });
        
        // ==========================================
        // 8. ì´ˆê¸°í™” ì‹œí€€ìŠ¤ (ë§¤ìš° ì¤‘ìš”!)
        // ==========================================
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM ë¡œë“œ ì™„ë£Œ');
            
            // 1ë‹¨ê³„: ì§€ë„ ì´ˆê¸°í™”
            initializeMap();
            
            // 2ë‹¨ê³„: í¬ê¸° ì¬ì¡°ì • (ì—¬ëŸ¬ ë²ˆ)
            fixMapSize();
            
            // 3ë‹¨ê³„: ë¡œë”© ì˜¤ë²„ë ˆì´ ì œê±°
            setTimeout(() => {
                document.getElementById('loadingOverlay').style.display = 'none';
                console.log('ë¡œë”© ì™„ë£Œ');
                
                // 4ë‹¨ê³„: ìµœì¢… í¬ê¸° ì¬ì¡°ì •
                fixMapSize();
            }, 1000);
        });
        
        // ==========================================
        // 9. ì°½ í¬ê¸° ë³€ê²½ ëŒ€ì‘
        // ==========================================
        let resizeTimeout;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                console.log('ì°½ í¬ê¸° ë³€ê²½ ê°ì§€');
                fixMapSize();
            }, 250);
        });
        
        // ==========================================
        // 10. ë””ë²„ê¹… ì •ë³´ (ì½˜ì†”)
        // ==========================================
        console.log('Leaflet ë²„ì „:', L.version);
        console.log('í™”ë©´ í¬ê¸°:', window.innerWidth, 'x', window.innerHeight);
    </script>
</body>
</html>