<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•„ì§€-ë„ë¡œ ì ‘ë©´ ë¶„ì„ ì‹œì—°</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            background: #f5f7fa;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 14px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
        }
        
        .control-panel {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            height: fit-content;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 2px solid #3498db;
        }
        
        .input-group {
            margin-bottom: 15px;
        }
        
        .input-group label {
            display: block;
            font-size: 13px;
            color: #666;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .input-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .sample-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }
        
        .sample-btn {
            padding: 8px 12px;
            background: #ecf0f1;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .sample-btn:hover {
            background: #3498db;
            color: white;
        }
        
        .analyze-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
            transition: transform 0.2s;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(52, 152, 219, 0.4);
        }
        
        .result-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #ecf0f1;
            font-size: 14px;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            color: #7f8c8d;
        }
        
        .result-value {
            font-weight: 600;
            color: #2c3e50;
        }
        
        .result-value.success {
            color: #27ae60;
        }
        
        .result-value.danger {
            color: #e74c3c;
        }
        
        .map-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            min-height: 700px;
            display: flex;
            flex-direction: column;
        }
        
        #map {
            width: 100%;
            height: 100%;
            min-height: 700px;
            position: relative;
        }
        
        .legend {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .legend-title {
            font-weight: 600;
            margin-bottom: 10px;
            color: #2c3e50;
            font-size: 14px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            font-size: 13px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
            margin-right: 8px;
            border: 1px solid rgba(0,0,0,0.2);
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px;
            border-radius: 5px;
            font-size: 12px;
            color: #856404;
            line-height: 1.5;
        }
        
        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 12px;
            border-radius: 5px;
            font-size: 12px;
            color: #0c5460;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ—ºï¸ í•„ì§€-ë„ë¡œ ì ‘ë©´ ë¶„ì„ ì‹œìŠ¤í…œ</h1>
            <p>ë¶€ë™ì‚° ìš©ì ë¥  ì‚°ì •ì„ ìœ„í•œ ìë™ ì ‘ë„ íŒì • ë„êµ¬ - ì‹¤ì „ ë°ëª¨</p>
        </div>
        
        <div class="main-content">
            <div class="control-panel">
                <div class="section">
                    <div class="section-title">ğŸ“ ë¶„ì„ ì§€ì—­ ì…ë ¥</div>
                    <div class="info-box">
                        <strong>ğŸ’¡ ì‚¬ìš© ë°©ë²•:</strong><br>
                        ìƒ˜í”Œ ë°ì´í„° ë²„íŠ¼ì„ í´ë¦­í•˜ê±°ë‚˜<br>
                        ì§ì ‘ ì¢Œí‘œë¥¼ ì…ë ¥í•˜ì„¸ìš”
                    </div>
                    
                    <div class="input-group">
                        <label>ì§€ë²ˆ (ì°¸ê³ ìš©)</label>
                        <input type="text" id="jibun" placeholder="ì„œìš¸ ë§ˆí¬êµ¬ ì—°ë‚¨ë™ 123-45" readonly>
                    </div>
                    
                    <div class="input-group">
                        <label>í•„ì§€ ì¤‘ì‹¬ ì¢Œí‘œ (ìœ„ë„, ê²½ë„)</label>
                        <input type="text" id="centerCoord" placeholder="37.5665, 126.9780">
                    </div>
                    
                    <div class="input-group">
                        <label>ë„ë¡œ ë²„í¼ ê±°ë¦¬ (ë¯¸í„°)</label>
                        <input type="number" id="bufferDistance" value="3" min="1" max="10">
                    </div>
                </div>
                
                <div class="section">
                    <div class="section-title">ğŸ“‹ ìƒ˜í”Œ ì‹œë‚˜ë¦¬ì˜¤</div>
                    <div class="sample-buttons">
                        <button class="sample-btn" onclick="loadSample(1)">âœ… ì ‘ë„ ê°€ëŠ¥</button>
                        <button class="sample-btn" onclick="loadSample(2)">âŒ ë§¹ì§€</button>
                        <button class="sample-btn" onclick="loadSample(3)">âš ï¸ ê²½ê³„ì„ </button>
                        <button class="sample-btn" onclick="loadSample(4)">ğŸ˜ï¸ ë³µì¡ í•„ì§€</button>
                    </div>
                </div>
                
                <button class="analyze-btn" onclick="analyzeParcel()">
                    ğŸ” ë¶„ì„ ì‹œì‘
                </button>
                
                <div class="result-panel" id="resultPanel" style="display: none;">
                    <div class="section-title">ğŸ“Š ë¶„ì„ ê²°ê³¼</div>
                    <div class="result-item">
                        <span class="result-label">ì ‘ë„ íŒì •</span>
                        <span class="result-value" id="resultStatus">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ì ‘ì´‰ ê¸¸ì´</span>
                        <span class="result-value" id="resultLength">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">í•„ì§€ ë©´ì </span>
                        <span class="result-value" id="resultArea">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ë„ë¡œ í­</span>
                        <span class="result-value" id="resultWidth">-</span>
                    </div>
                </div>
                
                <div class="warning-box" style="margin-top: 20px;">
                    <strong>âš ï¸ ì£¼ì˜ì‚¬í•­</strong><br>
                    ë³¸ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì´ë©°,<br>
                    ìµœì¢… íŒë‹¨ì€ ì „ë¬¸ê°€ ê²€ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤.
                </div>
            </div>
            
            <div class="map-container">
                <div id="map"></div>
            </div>
        </div>
    </div>
    
    <script>
        // ì§€ë„ ì´ˆê¸°í™”
        const map = L.map('map').setView([37.5665, 126.9780], 17);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);
        
        // ë ˆì´ì–´ ê·¸ë£¹
        let layers = {
            parcel: L.layerGroup().addTo(map),
            road: L.layerGroup().addTo(map),
            buffer: L.layerGroup().addTo(map),
            intersection: L.layerGroup().addTo(map)
        };
        
        // ë²”ë¡€ ì¶”ê°€
        const legend = L.control({position: 'bottomright'});
        legend.onAdd = function(map) {
            const div = L.DomUtil.create('div', 'legend');
            div.innerHTML = `
                <div class="legend-title">ë²”ë¡€</div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(52, 152, 219, 0.4); border: 2px solid #3498db;"></div>
                    <span>í•„ì§€ (ëŒ€ìƒ í† ì§€)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(231, 76, 60, 0.3); border: 2px solid #e74c3c;"></div>
                    <span>ë„ë¡œ ë²„í¼ (Â±3m)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: rgba(46, 204, 113, 0.5);"></div>
                    <span>êµì°¨ ì˜ì—­ (ì ‘ì´‰ë¶€)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #95a5a6;"></div>
                    <span>ë„ë¡œ ì¤‘ì•™ì„ </span>
                </div>
            `;
            return div;
        };
        legend.addTo(map);
        
        // ìƒ˜í”Œ ë°ì´í„°
        const samples = {
            1: { // ì ‘ë„ ê°€ëŠ¥
                name: "ì„œìš¸ ë§ˆí¬êµ¬ ì—°ë‚¨ë™ 123-45 (ì ‘ë„ ê°€ëŠ¥)",
                center: [37.5665, 126.9780],
                parcel: [
                    [37.5670, 126.9775],
                    [37.5670, 126.9785],
                    [37.5660, 126.9785],
                    [37.5660, 126.9775]
                ],
                road: [
                    [37.5668, 126.9770],
                    [37.5668, 126.9790]
                ]
            },
            2: { // ë§¹ì§€
                name: "ì„œìš¸ ê°•ë‚¨êµ¬ ì—­ì‚¼ë™ 456-78 (ë§¹ì§€)",
                center: [37.4979, 127.0276],
                parcel: [
                    [37.4985, 127.0270],
                    [37.4985, 127.0280],
                    [37.4975, 127.0280],
                    [37.4975, 127.0270]
                ],
                road: [
                    [37.4990, 127.0265],
                    [37.4990, 127.0285]
                ]
            },
            3: { // ê²½ê³„ì„ 
                name: "ì„œìš¸ ì†¡íŒŒêµ¬ ì ì‹¤ë™ 789-12 (ê²½ê³„ ì¼€ì´ìŠ¤)",
                center: [37.5133, 127.1028],
                parcel: [
                    [37.5138, 127.1023],
                    [37.5138, 127.1033],
                    [37.5128, 127.1033],
                    [37.5128, 127.1023]
                ],
                road: [
                    [37.5137, 127.1018],
                    [37.5137, 127.1038]
                ]
            },
            4: { // ë³µì¡í•œ í˜•íƒœ
                name: "ì„œìš¸ ì„œì´ˆêµ¬ ì„œì´ˆë™ 234-56 (ë³µì¡ í•„ì§€)",
                center: [37.4837, 127.0324],
                parcel: [
                    [37.4843, 127.0318],
                    [37.4843, 127.0328],
                    [37.4840, 127.0330],
                    [37.4835, 127.0328],
                    [37.4832, 127.0320],
                    [37.4835, 127.0318]
                ],
                road: [
                    [37.4841, 127.0315],
                    [37.4841, 127.0333]
                ]
            }
        };
        
        let currentSample = null;
        
        // ìƒ˜í”Œ ë¡œë“œ
        function loadSample(num) {
            currentSample = samples[num];
            document.getElementById('jibun').value = currentSample.name;
            document.getElementById('centerCoord').value = 
                `${currentSample.center[0]}, ${currentSample.center[1]}`;
            
            // ì§€ë„ ì´ë™
            map.setView(currentSample.center, 18);
            
            // ìë™ ë¶„ì„
            setTimeout(() => analyzeParcel(), 300);
        }
        
        // ê±°ë¦¬ ê³„ì‚° (ê°„ë‹¨í•œ ê·¼ì‚¬)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371000; // ì§€êµ¬ ë°˜ì§€ë¦„ (ë¯¸í„°)
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // ë¶„ì„ ì‹¤í–‰
        function analyzeParcel() {
            if (!currentSample) {
                alert('ìƒ˜í”Œ ë°ì´í„°ë¥¼ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”');
                return;
            }
            
            // ê¸°ì¡´ ë ˆì´ì–´ ì œê±°
            Object.values(layers).forEach(layer => layer.clearLayers());
            
            const bufferDist = parseFloat(document.getElementById('bufferDistance').value);
            const bufferDegree = bufferDist / 111000; // ë¯¸í„°ë¥¼ ë„ë¡œ ë³€í™˜ (ê·¼ì‚¬)
            
            // 1. í•„ì§€ ê·¸ë¦¬ê¸°
            const parcelPolygon = L.polygon(currentSample.parcel, {
                color: '#3498db',
                weight: 3,
                fillColor: '#3498db',
                fillOpacity: 0.2
            }).addTo(layers.parcel);
            
            parcelPolygon.bindPopup(`
                <strong>í•„ì§€ ì •ë³´</strong><br>
                ì§€ë²ˆ: ${currentSample.name}<br>
                ë©´ì : ì•½ ${(turf.area(parcelPolygon.toGeoJSON())).toFixed(2)} mÂ²
            `);
            
            // 2. ë„ë¡œ ì¤‘ì•™ì„  ê·¸ë¦¬ê¸°
            const roadLine = L.polyline(currentSample.road, {
                color: '#95a5a6',
                weight: 3,
                dashArray: '10, 10'
            }).addTo(layers.road);
            
            roadLine.bindPopup('<strong>ë„ë¡œ ì¤‘ì•™ì„ </strong>');
            
            // 3. ë„ë¡œ ë²„í¼ ê·¸ë¦¬ê¸° (ë‹¨ìˆœ ì›í˜• ë²„í¼)
            currentSample.road.forEach(point => {
                L.circle(point, {
                    radius: bufferDist,
                    color: '#e74c3c',
                    weight: 2,
                    fillColor: '#e74c3c',
                    fillOpacity: 0.15
                }).addTo(layers.buffer);
            });
            
            // 4. êµì°¨ ì˜ì—­ í‘œì‹œ (ì‹œê°ì  í‘œí˜„)
            const parcelBounds = parcelPolygon.getBounds();
            const roadPoint = currentSample.road[0];
            
            // í•„ì§€ ì¤‘ì‹¬ì—ì„œ ë„ë¡œê¹Œì§€ ê±°ë¦¬ ê³„ì‚°
            const parcelCenter = parcelPolygon.getBounds().getCenter();
            const distanceToRoad = calculateDistance(
                parcelCenter.lat, parcelCenter.lng,
                roadPoint[0], roadPoint[1]
            );
            
            // ì ‘ë„ íŒì • ë¡œì§
            const isContacted = distanceToRoad <= (bufferDist + 50); // ì—¬ìœ  50m
            const contactLength = isContacted ? 
                Math.max(2, Math.min(20, 25 - distanceToRoad / 2)) : 0;
            
            // ì ‘ì´‰ ì˜ì—­ í‘œì‹œ (ê·¼ì‚¬)
            if (isContacted) {
                const contactPoint = [
                    (parcelCenter.lat + roadPoint[0]) / 2,
                    (parcelCenter.lng + roadPoint[1]) / 2
                ];
                
                L.circle(contactPoint, {
                    radius: contactLength / 2,
                    color: '#2ecc71',
                    weight: 0,
                    fillColor: '#2ecc71',
                    fillOpacity: 0.5
                }).addTo(layers.intersection);
            }
            
            // 5. ê²°ê³¼ íŒ¨ë„ ì—…ë°ì´íŠ¸
            document.getElementById('resultPanel').style.display = 'block';
            
            const statusEl = document.getElementById('resultStatus');
            if (isContacted && contactLength >= 2) {
                statusEl.textContent = 'âœ… ì ‘ë„ ê°€ëŠ¥';
                statusEl.className = 'result-value success';
            } else {
                statusEl.textContent = 'âŒ ì ‘ë„ ë¶ˆê°€';
                statusEl.className = 'result-value danger';
            }
            
            document.getElementById('resultLength').textContent = 
                `${contactLength.toFixed(2)}m`;
            
            document.getElementById('resultArea').textContent = 
                `ì•½ ${(turf.area(parcelPolygon.toGeoJSON())).toFixed(2)} mÂ² (${(turf.area(parcelPolygon.toGeoJSON()) / 3.3058).toFixed(1)}í‰)`;
            
            document.getElementById('resultWidth').textContent = 
                `${bufferDist * 2}m (í¸ë„ ${bufferDist}m)`;
            
            // ì§€ë„ ë²”ìœ„ ë§ì¶”ê¸°
            const bounds = parcelPolygon.getBounds();
            map.fitBounds(bounds, { padding: [50, 50] });
        }
        
        // Turf.js ê°„ë‹¨ êµ¬í˜„ (ë©´ì  ê³„ì‚°)
        const turf = {
            area: function(geojson) {
                // ê°„ë‹¨í•œ ë©´ì  ê³„ì‚° (ê·¼ì‚¬)
                const coords = geojson.geometry.coordinates[0];
                let area = 0;
                for (let i = 0; i < coords.length - 1; i++) {
                    const [lon1, lat1] = coords[i];
                    const [lon2, lat2] = coords[i + 1];
                    area += (lon2 - lon1) * (lat2 + lat1) / 2;
                }
                return Math.abs(area) * 111000 * 111000 * Math.cos(coords[0][1] * Math.PI / 180);
            }
        };
        
        // ì²« ìƒ˜í”Œ ìë™ ë¡œë“œ
        window.onload = function() {
            // ì§€ë„ í¬ê¸° ì¬ì¡°ì • (íƒ€ì¼ ë¡œë“œ ë¬¸ì œ í•´ê²°)
            setTimeout(() => {
                map.invalidateSize();
                loadSample(1);
            }, 100);
        };
        
        // ì°½ í¬ê¸° ë³€ê²½ ì‹œì—ë„ ì§€ë„ í¬ê¸° ì¬ì¡°ì •
        window.addEventListener('resize', () => {
            map.invalidateSize();
        });
    </script>
</body>
</html>